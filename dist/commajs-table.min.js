!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("commajs-core")):"function"==typeof define&&define.amd?define(["commajs-core"],t):"object"==typeof exports?exports.CommaTable=t(require("commajs-core")):e.CommaTable=t(e["commajs-core"])}(window,function(o){return r={},i.m=n=[function(e,t){e.exports=o},function(e,t,o){"use strict";o.r(t),o.d(t,"default",function(){return v});var p=o(0);function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function r(e,t,o){return t&&n(e.prototype,t),o&&n(e,o),e}var i=function(){function i(e,t,o){d(this,i),this.onChangeCallback=o;var n=document.createElement("div");n.style.position="absolute",n.style.zIndex="99999",n.style.border="1px solid #e1e1e1",n.style.borderRadius="2px",n.style.backgroundColor="#f9f9f9",n.style.padding="4px",n.style.left=e,n.style.top=t,n.style.outline="none",n.setAttribute("tabindex","3333"),n.addEventListener("blur",function(){this.parentNode.removeChild(this)}),this.canvas=document.createElement("canvas"),this.width=200,this.height=140,this.canvas.width=this.width,this.canvas.height=this.height,this.canvas.style.cursor="pointer",this.context=this.canvas.getContext("2d"),this.pickerCircle={x:10,y:10,width:7,height:7},this.draw(),n.appendChild(this.canvas),this.previewbox=document.createElement("div"),this.previewbox.style.width="200px",this.previewbox.style.height="14px",this.previewbox.style.backgroundColor="rgba(0,0,0,0)",n.appendChild(this.previewbox),this.listenForEvents(),document.body.appendChild(n),n.focus(),this.panel=n}return r(i,[{key:"draw",value:function(){this.build()}},{key:"build",value:function(){var e=this.context.createLinearGradient(0,0,this.width,0);e.addColorStop(0,"rgb(255, 0, 0)"),e.addColorStop(.15,"rgb(255, 0, 255)"),e.addColorStop(.33,"rgb(0, 0, 255)"),e.addColorStop(.49,"rgb(0, 255, 255)"),e.addColorStop(.67,"rgb(0, 255, 0)"),e.addColorStop(.84,"rgb(255, 255, 0)"),e.addColorStop(1,"rgb(255, 0, 0)"),this.context.fillStyle=e,this.context.fillRect(0,0,this.width,this.height),(e=this.context.createLinearGradient(0,0,0,this.height)).addColorStop(0,"rgba(255, 255, 255, 1)"),e.addColorStop(.5,"rgba(255, 255, 255, 0)"),e.addColorStop(.5,"rgba(0, 0, 0, 0)"),e.addColorStop(1,"rgba(0, 0, 0, 1)"),this.context.fillStyle=e,this.context.fillRect(0,0,this.width,this.height),this.context.beginPath(),this.context.arc(this.pickerCircle.x,this.pickerCircle.y,this.pickerCircle.width,0,2*Math.PI),this.context.strokeStyle="#ffffff",this.context.stroke(),this.context.closePath()}},{key:"listenForEvents",value:function(){var i=this;this.canvas.addEventListener("mousemove",function(e){var t=i.canvas.getBoundingClientRect(),o=e.clientX-t.left,n=e.clientY-t.top;i.pickerCircle.x=o,i.pickerCircle.y=n,i.previewbox.style.backgroundColor=i.getPickedColor(),i.draw()}),this.canvas.addEventListener("click",function(){return i.SelectColor()})}},{key:"getPickedColor",value:function(){var e=this.context.getImageData(this.pickerCircle.x,this.pickerCircle.y,1,1);return"#"+this.fullColorHex(e.data[0],e.data[1],e.data[2])}},{key:"SelectColor",value:function(){try{this.panel.parentNode.removeChild(this.panel)}catch(e){}this.onChangeCallback(this.getPickedColor())}},{key:"rgbToHex",value:function(e){var t=Number(e).toString(16);return t.length<2&&(t="0"+t),t}},{key:"fullColorHex",value:function(e,t,o){return this.rgbToHex(e)+this.rgbToHex(t)+this.rgbToHex(o)}}]),i}(),l=function(){function s(e,t){var o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:void 0,r=5<arguments.length&&void 0!==arguments[5]&&arguments[5],l=6<arguments.length&&void 0!==arguments[6]&&arguments[6];d(this,s),this.event=e,this.callBack=t,this.preserveFocus=l,this.keepOnAfterSelection=r,this.addToLeft=o,this.addToTop=n,this.selectedColor=this._parseSelectedColor(i),this.usedCustomColors=[],"undefined"!=typeof Storage&&(this.usedCustomColors=JSON.parse(localStorage.getItem("usedCustomColors")),null==this.usedCustomColors&&(this.usedCustomColors=[])),this._showColorPalette()}return r(s,[{key:"_parseSelectedColor",value:function(e){var t,o=e;return null!=e&&-1<e.toLowerCase().indexOf("rgb")&&(t=(e=e.toLowerCase()).split("(")[1].split(")")[0].split(","),o="#"+this._rgbToHex(t[0].split(" ").join(""))+this._rgbToHex(t[1].split(" ").join(""))+this._rgbToHex(t[2].split(" ").join(""))),o}},{key:"_rgbToHex",value:function(e){var t=Number(e).toString(16);return t.length<2&&(t="0"+t),t}},{key:"_showColorPalette",value:function(){var o=this,n=document.createElement("div");n.style.position="absolute",n.style.zIndex="99999",n.style.border="1px solid #e1e1e1",n.style.borderRadius="2px",n.style.backgroundColor="#f9f9f9",n.style.padding="4px 4px 0px 0px",n.style.outline="none",n.setAttribute("tabindex","123");var e=this.event.srcElement.getBoundingClientRect();n.style.left=e.left+parseInt(this.addToLeft)+"px",n.style.top=parseInt(this.addToTop)+ +window.scrollY+e.height+e.top+"px";var t=[];t.push(["#dfb9b1","#eecdcd","#f8e5d0","#fdf2d0","#dce9d5","#d3dfe2","#ccdaf5","#d2e1f1","#d8d2e7","#e6d2db"]),t.push(["#d08270","#de9c9b","#f2cca2","#fbe5a3","#bcd5ac","#a9c3c8","#a9c2f0","#a6c4e5","#b2a8d2","#cea8bc"]),t.push(["#bd4b31","#d16d6a","#ecb476","#ffefa1","#9dc284","#80a4ad","#779ee5","#7ba7d7","#8b7ebe","#b87f9e"]),t.push(["#982a15","#bb261a","#da944b","#eac251","#78a55a","#53808c","#4a79d1","#4f85c1","#6351a2","#9b5378"]),t.push(["#7a2817","#8c1a11","#a96324","#b89130","#48742c","#264e5b","#2657c5","#24538f","#312071","#6b2346"]);var i=document.createElement("div");i.style.display="flex",i.style.marginTop="2px",i.style.marginBottom="6px",["#000000","#39434d","#666666","#999999","#b7b7b7","#cccccc","#d9d9d9","#efefef","#ffffff","TRANSPARENT"].forEach(function(e){var t=o._getDomCell_colorPicker(e,n);i.appendChild(t)}),n.appendChild(i),t.forEach(function(e){(i=document.createElement("div")).style.display="flex",e.forEach(function(e){var t=o._getDomCell_colorPicker(e,n);i.appendChild(t)}),n.appendChild(i)});var r,l=document.createElement("div");l.style.display="flex",l.style.justifyContent="center",l.style.alignItems="center",l.style.cursor="pointer",l.style.fontFamily="Arial",l.style.padding="2px 4px 2px 4px",l.style.fontSize="14px",l.style.color="#999999",l.textContent="Custom",l.addEventListener("mouseover",function(){this.style.color="#30b7e8"}),l.addEventListener("mouseout",function(){this.style.color="#999999"}),l.addEventListener("click",function(){o.pnl.style.display="none",o.ShowCustomPanel()}),n.appendChild(l),0<this.usedCustomColors.length?((r=document.createElement("div")).style.display="flex",r.style.marginTop="2px",r.style.marginBottom="0px",this.usedCustomColors.forEach(function(e){var t=o._getDomCell_colorPicker(e,n);r.appendChild(t)}),n.appendChild(r)):l.style.padding="2px 4px 4px 4px",n.addEventListener("blur",function(){o.keepOnAfterSelection||this.parentNode.removeChild(this)}),document.body.appendChild(n),n.focus(),this.pnl=n}},{key:"_getDomCell_colorPicker",value:function(e){var t,o=this,n=e,i=this.selectedColor,r=void 0;return"TRANSPARENT"==e?((r=document.createElement("canvas")).width=13,r.height=13,r.style.border="2px solid #ffffff",r.style.margin="0px 0px 4px 4px ",r.style.borderRadius="2px",(t=r.getContext("2d")).fillStyle="#ffffff",t.fillRect(0,0,r.width,r.height),t.strokeStyle="#FF0000",t.lineWidth=2,t.beginPath(),t.moveTo(0,13),t.lineTo(13,0),t.stroke()):((r=document.createElement("div")).style.width="13px",r.style.height="13px",r.style.backgroundColor=n,r.style.margin="0px 0px 4px 4px ",r.style.borderRadius="2px",r.style.border=i==n?"2px solid #30b7e8":"2px solid "+n),r.addEventListener("mouseover",function(){this.style.cursor="pointer",this.style.border="2px solid #30b7e8"}),r.addEventListener("mouseout",function(){this.style.border=n!=i?"TRANSPARENT"==n?"2px solid #ffffff":"2px solid "+n:"2px solid #30b7e8"}),r.addEventListener("click",function(){if(o.callBack(n),!o.keepOnAfterSelection)try{o.pnl.parentNode.removeChild(o.pnl)}catch(e){}}),this.preserveFocus&&r.addEventListener("mousedown",function(e){e.preventDefault()}),r}},{key:"ShowCustomPanel",value:function(){var t=this;new i(this.pnl.style.left,this.pnl.style.top,function(e){t.usedCustomColors.indexOf(e)<0&&(t.usedCustomColors.push(e),10<t.usedCustomColors.length&&t.usedCustomColors.shift(),localStorage.setItem("usedCustomColors",JSON.stringify(t.usedCustomColors))),t.callBack(e),null===t.pnl.parentNode||t.pnl.parentNode.removeChild(t.pnl)})}}]),s}();function s(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var a=function(){function n(e,t,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this.table=e,this.td=t,this.event=o,this.additionalPnl=void 0,this.inputForFocus=void 0,this.Init()}var e,t,o;return e=n,(t=[{key:"Init",value:function(){var e=this,t=document.createElement("div");t.style.backgroundColor="#ffffff",t.style.width="180px",t.style.height="264px",t.style.borderRadius="2px",t.style.boxShadow="2px 2px 5px #e3e3e3",t.style.position="fixed";var o=this.event.clientX+4,n=this.event.clientY-60;n<0&&(n=1),n+264>window.innerHeight&&(n=window.innerHeight-266),t.style.left=o+"px",t.style.top=n+"px",t.style.overflow="auto",t.style.zIndex="999";var i=document.createElement("input");i.style.opacity=0,i.style.position="absolute",i.style.width="0px",i.style.height="0px",this.keepAlive=!1,i.addEventListener("blur",function(){e.exitingRightBorder||(e._removeRequestNumberPanel(),setTimeout(function(){e.keepAlive||e.destroy()},200))}),this.inputForFocus=i,t.appendChild(i);var r="";1<this.table.selectedNodes.length&&(r="s"),t=this._addMenuEntry(t,"addRowAbove","Insert Row(s) Above",!0),t=this._addMenuEntry(t,"addRowBelow","Insert Row(s) Below",!0),t=this._addMenuSpace(t),t=this._addMenuEntry(t,"addColLeft","Insert Column(s) Before",!0),t=this._addMenuEntry(t,"addColRight","Insert Column(s) After",!0),t=this._addMenuSpace(t),t=this._addMenuEntry(t,"delRow","Delete Row"+r),t=this._addMenuEntry(t,"delCol","Delete Column"+r),t=this._addMenuSpace(t),t=this._addMenuEntry(t,"cellBgColor","Background Color"),t=this._addMenuEntry(t,"borderColor","Border Color"),t=this._addMenuSpace(t),t=this._addMenuEntry(t,"distributeRows","Distribute Rows"),t=this._addMenuEntry(t,"distributeCols","Distribute Columns"),document.body.appendChild(t),i.focus(),this.panel=t}},{key:"refreshFocus",value:function(){this.inputForFocus.focus()}},{key:"_addMenuEntry",value:function(e,t,o,n){var i=3<arguments.length&&void 0!==n&&n,r=this,l=document.createElement("div");return l.style.padding="6px 10px 6px 10px",l.style.fontFamily="Arial",l.style.fontSize="12px",l.style.margin="0px",l.style.cursor="pointer",l.style.backgroundColor="#ffffff",l.style.color="#828282",l.innerText=o,i?(l.addEventListener("mouseover",function(e){r.refreshFocus(),r._removeRequestNumberPanel(),this.style.backgroundColor="#FF9100",this.style.color="#ffffff",r._showRequestNumber(this,t),r.exitingRightBorder=!1}),l.addEventListener("mousemove",function(e){var t=this.getBoundingClientRect(),o=t.width,n=t.width-4;e.offsetX>=n&&e.offsetX<=o&&(r.exitingRightBorder=!0)})):(l.addEventListener("mouseover",function(e){r.exitingRightBorder=!1,this.style.backgroundColor="#FF9100",this.style.color="#ffffff"}),l.addEventListener("click",function(e){r.PerformAction(t)})),l.addEventListener("mouseout",function(e){r.exitingRightBorder||r._removeRequestNumberPanel(),this.style.backgroundColor="#ffffff",this.style.color="#828282"}),e.appendChild(l),e}},{key:"_addMenuSpace",value:function(e){var t=document.createElement("div");return t.style.height="1px",t.style.backgroundColor="#e3e3e3",e.appendChild(t),e}},{key:"_showRequestNumber",value:function(e,t){var o=this,n="Rows:";-1<t.indexOf("Col")&&(n="Cols:");var i=e.getBoundingClientRect(),r=document.createElement("div");r.style.backgroundColor="#ffffff",r.style.width="180px",r.style.height=i.height+"px",r.style.borderRadius="0px 2px 2px 0px",r.style.boxShadow="2px 2px 5px #e3e3e3",r.style.display="flex",r.style.alignItems="center",r.style.zIndex="9999",r.style.fontFamily="Arial",r.style.fontSize="12px",r.style.color="#828282",r.style.position="fixed",r.style.top=i.top+"px",r.style.left=i.left+i.width+"px";var l=document.createElement("div");l.style.padding="0px 4px 0px 4px",l.textContent=n,r.appendChild(l);var s=document.createElement("input");s.style.display="block",s.style.width="40px",s.style.outline="none",s.style.border="1px solid #e1e1e1",s.style.borderRadius="3px",s.style.color="#828282",s.style.fontFamily="Arial",s.style.fontSize="12px",s.value=1,s.addEventListener("click",function(e){this.select()}),r.appendChild(s);var d=document.createElement("div");d.style.padding="0px 0px 0px 4px",d.style.cursor="pointer",d.textContent="add",d.addEventListener("click",function(e){o.PerformAction(t,s.value),o._removeRequestNumberPanel(),o.destroy()}),r.appendChild(d),document.body.appendChild(r),this.additionalPnl=r}},{key:"_removeRequestNumberPanel",value:function(){null!=this.additionalPnl&&null!=this.additionalPnl.parentNode&&this.additionalPnl.parentNode.removeChild(this.additionalPnl)}},{key:"destroy",value:function(){this.panel.parentNode.removeChild(this.panel)}},{key:"PerformAction",value:function(e,t){if(0<this.table.selectedNodes.length){var o=this.table.selectedNodes.length-1;switch(e){case"addRowAbove":if(0<t){for(;0<t;)this.AddRow("above",this.table.selectedNodes[0].parent),t--;this.table.rootNode.document.PushToHistory()}break;case"addRowBelow":if(0<t){for(;0<t;)this.AddRow("below",this.table.selectedNodes[o].parent),t--;this.table.rootNode.document.PushToHistory()}break;case"addColLeft":if(0<t){for(;0<t;)this.AddColumn("left",this.table.selectedNodes[0]),t--;this.table.rootNode.document.PushToHistory()}break;case"addColRight":if(0<t){for(;0<t;)this.AddColumn("right",this.table.selectedNodes[o]),t--;this.table.rootNode.document.PushToHistory()}break;case"delRow":this.DeleteRows(),this.table.rootNode.document.PushToHistory();break;case"delCol":this.DeleteColumns(),this.table.rootNode.document.PushToHistory();break;case"cellBgColor":this.ShowPicColorPanel();break;case"borderColor":this.ShowPicBorderColorPanel();break;case"distributeRows":this.DistributeRows(),this.table.rootNode.document.PushToHistory();break;case"distributeCols":this.DistributeCols(),this.table.rootNode.document.PushToHistory();break;case"fitToScreen":this.FitToScreen(),this.table.rootNode.document.PushToHistory();break;case"mergeCells":this.MergeCells(),this.table.rootNode.document.PushToHistory();break;default:return}}}},{key:"MergeCells",value:function(){var n=this,i=[],r=!0,l=void 0,s=void 0,o=this.table.rootNode.document,d=void 0,a=1,c=1;this.table.selectedNodes.forEach(function(e){var t=e.GetAttribute("colspan"),o=e.GetAttribute("rowspan");null!=t&&""!=t&&(a=a+t-1),null!=o&&""!=o&&(c=c+o-1),r?(d=e,l=n.table.GetCoordinatesPerNode(e.id),r=!1):(i.push(e.id),s=n.table.GetCoordinatesPerNode(e.id))});var e=s.col-l.col+a,t=s.row-l.row+c;1<e&&(d.RemoveAttribute("colspan"),d.AddAttribute("colspan",e)),1<t&&(d.RemoveAttribute("rowspan"),d.AddAttribute("rowspan",t)),this.table.rootNode.children.forEach(function(e){"tbody"==e.tagName.toLowerCase()&&e.children.forEach(function(e){var t=[];e.children.forEach(function(e){i.indexOf(e.id)<0?t.push(e):o.DeleteNode(e)}),0<t.length||o.DeleteNode(e)})}),this.table.Init()}},{key:"ShowPicBorderColorPanel",value:function(){this.HideButKeepAlive();var t=this;new l(this.event,function(e){t.ChangBorderColor(e)},-20,6)}},{key:"ChangBorderColor",value:function(t){this.table.selectedNodes.forEach(function(e){e.domElement.style.border="1px double "+t}),this.table.rootNode.document.PushToHistory()}},{key:"DistributeRows",value:function(){this.table.rootNode.document;var n=this.table.rootNode.domElement.getBoundingClientRect().height;this.table.rootNode.children.forEach(function(e){var t,o;"tbody"==e.tagName.toLowerCase()&&(t=e.children.length,o=n/t,e.children.forEach(function(e){e.children.forEach(function(e){e.domElement.style.height=o+"px"})}))})}},{key:"DistributeCols",value:function(){this.table.rootNode.document;var i=this.table.rootNode.domElement.getBoundingClientRect().width;this.table.rootNode.children.forEach(function(e){var o,n;"tbody"==e.tagName.toLowerCase()&&(o=!0,n=void 0,e.children.forEach(function(e){var t;o&&(o=!1,t=e.children.length,n=i/t),e.children.forEach(function(e){e.domElement.style.width=n+"px"})}))})}},{key:"FitToScreen",value:function(){this.table.rootNode.domElement.style.width="100%"}},{key:"HideButKeepAlive",value:function(){this.keepAlive=!0,this.panel.style.display="none"}},{key:"ShowPicColorPanel",value:function(){this.HideButKeepAlive();var t=this;new l(this.event,function(e){t.ChangCellBgColor(e)},-20,6)}},{key:"ChangCellBgColor",value:function(t){this.table.selectedNodes.forEach(function(e){e.domElement.style.backgroundColor=t}),this.table.rootNode.document.PushToHistory()}},{key:"DeleteRows",value:function(){var n=[];this.table.selectedNodes.forEach(function(e){n.indexOf(e.parent.id)<0&&n.push(e.parent.id)});var i=this.table.rootNode.document;this.table.rootNode.children.forEach(function(t){var o;"tbody"==t.tagName.toLowerCase()&&(o=[],t.children.forEach(function(e){n.indexOf(e.id)<0?o.push(e):i.DeleteNode(e)}),t.children=[],o.forEach(function(e){t.Append(e)}))}),this.table.Init()}},{key:"DeleteColumns",value:function(){var o=[];this.table.selectedNodes.forEach(function(e){o.push(e.id)});var n=[];this.table.rootNode.children.forEach(function(e){"tbody"==e.tagName.toLowerCase()&&e.children.forEach(function(e){var t=0;e.children.forEach(function(e){o.indexOf(e.id)<0||o.indexOf(t)<0&&n.push(parseInt(t)),t++})})});var i=this.table.rootNode.document;this.table.rootNode.children.forEach(function(e){"tbody"==e.tagName.toLowerCase()&&e.children.forEach(function(e){var t=0;e.children.forEach(function(e){n.indexOf(t)<0||i.DeleteNode(e),t++})})}),this.table.Init()}},{key:"AddRow",value:function(n,i){var r=v.AddRow(i.document,this.table.numberOfColumns,i.GetFirstTextNode().nodeStyle).tr;this.table.rootNode.children.forEach(function(t){var o;"tbody"==t.tagName.toLowerCase()&&(o=[],t.children.forEach(function(e){e.id==i.id?"above"==n?(o.push(r),o.push(e)):"below"==n&&(o.push(e),o.push(r)):o.push(e)}),t.children=[],o.forEach(function(e){t.Append(e)}))}),this.table.Init()}},{key:"AddColumn",value:function(n,r){var l=r.GetFirstTextNode().nodeStyle,s=void 0,d=!1;this.table.rootNode.children.forEach(function(e){"tbody"==e.tagName.toLowerCase()&&e.children.forEach(function(t){var o=0;t.children.forEach(function(e){e.id==r.id&&("left"==n?s=parseInt(o):"right"==n&&(s=parseInt(o+1)),s==t.children.length&&(d=!0)),o++})})}),this.table.rootNode.children.forEach(function(e){"tbody"==e.tagName.toLowerCase()&&e.children.forEach(function(n){var i=0;n.children.forEach(function(e){var t,o=!1;(s==i||d&&i==n.children.length-1)&&(o=!0),o&&(t=v.AddCell(r.document,l).td,n.Append(t,s)),i++})})}),this.table.Init()}}])&&s(e.prototype,t),o&&s(e,o),n}();function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function h(e,t,o){return t&&u(e.prototype,t),o&&u(e,o),e}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function m(r){var l=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t,o,n,i=f(r);return t=l?(e=f(this).constructor,Reflect.construct(i,arguments,e)):i.apply(this,arguments),o=this,!(n=t)||"object"!==c(n)&&"function"!=typeof n?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(o):n}}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var v=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}(f,p["Plugin"]);var o=m(f);function f(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f),(t=o.call(this,e)).isMouseDown=!1,t.isMouseOnRightBorder=!1,t.isMouseOnBottomBorder=!1,t.currentColResizing=void 0,t.currentRowResizing=void 0,t.startNode=void 0,t.endNode=void 0,t.selectedNodes=[],t.numberOfRows=0,t.numberOfColumns=0,t.cellsResized=!1,t.readOnly=t.rootNode.document.readOnly,t.InitializeDomElements(),t}return h(f,null,[{key:"GetName",value:function(){return"table"}}]),h(f,[{key:"InitializeDomElements",value:function(e){var t;null==this.rootNode.parent?(t=this,null==e?e=0:e++,e<50?setTimeout(function(){t.InitializeDomElements(e)},100):console.log("#345-23")):this.readOnly||this.Init()}},{key:"Init",value:function(){var t=this;this.coordinatesPerNode=new Array,this.nodePerCoordinates=new Array;function e(e){t.isMouseDown&&(t.isMouseOnRightBorder?t.ResizeColumn(e):t.isMouseOnBottomBorder&&t.ResizeRow(e))}var o=0,n=0;this.rootNode.parent.domElement.removeEventListener("mousemove",e),this.rootNode.parent.domElement.addEventListener("mousemove",e),this.rootNode.children.forEach(function(e){"tbody"==e.tagName.toLowerCase()&&e.children.forEach(function(e){n=0,e.children.forEach(function(e){t.InitCell(e.domElement,o,n),null==t.coordinatesPerNode[o]&&(t.coordinatesPerNode[o]=new Array),t.coordinatesPerNode[o][n]=e,t.nodePerCoordinates[e.id]={col:n,row:o},n++}),o++})}),this.numberOfRows=o,this.numberOfColumns=n;function i(e){0==e.button&&(t.isMouseDown=!1)}document.body.removeEventListener("mouseup",i),document.body.addEventListener("mouseup",i)}},{key:"InitCell",value:function(e,p,y){function t(e){0==m.selectedNodes.length?m.SelectCell(p,y,!0):1==m.selectedNodes.length&&m.SelectCell(p,y,!1),m.OpenSettingsPanel(this,e),e.preventDefault(),e.stopPropagation()}function o(e){var t,o,n,i,r,l,s,d,a,c,u,h,f;0==e.button&&(m.isMouseDown?m.isMouseOnRightBorder||m.isMouseOnBottomBorder||(o=(t=m.startNode.domElement.getBoundingClientRect()).height,n=t.width,i=t.top,r=t.left,l=e.pageY+window.scrollY,s=e.pageX+window.scrollX,i<l&&l<i+o&&r<s&&s<r+n||(window.getSelection&&document.createRange?(d=window.getSelection()).empty?d.empty():d.removeAllRanges&&d.removeAllRanges():document.selection&&(d=document.selection.createRange()).empty(),m.SelectOnDrag(p,y),e.preventDefault())):(c=(a=this.getBoundingClientRect()).width,u=a.width-6,e.offsetX>=u&&e.offsetX<=c?(m.isMouseOnRightBorder=!0,m.currentColResizing=y,this.style.cursor="col-resize"):(m.isMouseOnRightBorder=!1,m.currentColResizing=void 0,this.style.cursor="auto"),m.isMouseOnRightBorder||(h=a.height,f=a.height-6,e.offsetY>=f&&e.offsetY<=h?(m.isMouseOnBottomBorder=!0,m.currentRowResizing=p,this.style.cursor="row-resize"):(m.isMouseOnBottomBorder=!1,m.currentRowResizing=void 0,this.style.cursor="auto"))))}function n(e){0==e.button&&(m.cellsResized&&(m.cellsResized=!1,m.PushToHistory()),m.isMouseDown=!1,m.endNode=m.GetNodeFromDom(this),m.endNode.row=p,m.endNode.col=y)}var m=this;e.removeEventListener("contextmenu",t),e.addEventListener("contextmenu",t),e.removeEventListener("mousedown",t),e.addEventListener("mousedown",function(e){m.prevX=e.pageX+window.scrollX,m.prevY=e.pageY+window.scrollY,0==e.button&&(m.DeselectAll(),m.isMouseDown=!0,m.startNode=m.GetNodeFromDom(this),m.startNode.row=p,m.startNode.col=y,m.endNode=void 0,m.SelectCell(p,y,!1))}),e.removeEventListener("mousemove",o),e.addEventListener("mousemove",o),e.removeEventListener("mouseup",n),e.addEventListener("mouseup",n)}},{key:"PushToHistory",value:function(){this.rootNode.document.PushToHistory()}},{key:"GetCoordinatesPerNode",value:function(e){return this.nodePerCoordinates[e]}},{key:"GetNodePerCoordinates",value:function(e,t){return this.coordinatesPerNode[e][t]}},{key:"GetTableDimensions",value:function(){var e={cols:0,rows:0},t=0,o=0;return this.rootNode.children.forEach(function(e){"tbody"==e.tagName.toLowerCase()&&e.children.forEach(function(e){0==t&&e.children.forEach(function(e){t++}),o++})}),e.cols=t,e.rows=o,e}},{key:"ResizeRow",value:function(i){var e,t,r,l,s;null!=this.currentRowResizing&&(window.getSelection&&document.createRange?(e=window.getSelection()).empty?e.empty():e.removeAllRanges&&e.removeAllRanges():document.selection&&(e=document.selection.createRange()).empty(),l=!(t=0),s=0,(r=this).rootNode.children.forEach(function(e){"tbody"==e.tagName.toLowerCase()&&(t=0,e.children.forEach(function(e){t==r.currentRowResizing&&e.children.forEach(function(e){var t,o,n;l&&(t=e.domElement.getBoundingClientRect(),n=(o=i.pageY)-r.prevY,s=t.height+n,r.prevY=o,l=!1),e.domElement.style.height=s+"px",r.cellsResized=!0}),t++}))}))}},{key:"ResizeColumn",value:function(r){var e,l,s,d,a,c,u;null!=this.currentColResizing&&(window.getSelection&&document.createRange?(e=window.getSelection()).empty?e.empty():e.removeAllRanges&&e.removeAllRanges():document.selection&&(e=document.selection.createRange()).empty(),c=a=l=0,u=!(d=!0),(s=this).rootNode.children.forEach(function(e){"tbody"==e.tagName.toLowerCase()&&e.children.forEach(function(e){l=0,e.children.forEach(function(e){var t,o,n,i;l==s.currentColResizing&&(d&&(t=e.domElement.getBoundingClientRect(),n=(o=r.pageX+window.scrollX)-s.prevX,a=t.width+n,s.prevX=o,null!=e.next&&(u=!0,i=e.next.domElement.getBoundingClientRect(),c=i.width-n),d=!1),e.domElement.style.width=a+"px",u&&null!=e.next&&(e.next.domElement.style.width=c+"px"),s.cellsResized=!0),l++})})}))}},{key:"SelectCell",value:function(t,o,e){null!=e&&0!=e||this.DeselectAll();var n=0,i=0,r=this;this.rootNode.children.forEach(function(e){"tbody"==e.tagName.toLowerCase()&&e.children.forEach(function(e){i=0,e.children.forEach(function(e){n==t&&i==o&&(e.domElement.className="commaTableCellSelected",r.selectedNodes.push(e)),i++}),n++})})}},{key:"DeselectAll",value:function(){this.selectedNodes=[],null!=this.rootNode&&this.rootNode.children.forEach(function(e){"tbody"==e.tagName.toLowerCase()&&e.children.forEach(function(e){e.children.forEach(function(e){e.domElement.className="commaTableCell"})})})}},{key:"SelectOnDrag",value:function(t,o){var n,i,r,l,s,d,e=0,a=0,a=null==this.endNode?(e=this.startNode.row,this.startNode.col):(e=this.endNode.row,this.endNode.col);e==t&&a==o||(this.DeselectAll(),r="left",n=this.startNode.row,i=this.startNode.col,r=n<=t&&i<=o?"right":t<=n&&i<o?"topRight":n<=t&&o<=i?"bottomLeft":"left",s=l=0,(d=this).rootNode.children.forEach(function(e){"tbody"==e.tagName.toLowerCase()&&e.children.forEach(function(e){s=0,e.children.forEach(function(e){"right"==r?n<=l&&l<=t&&i<=s&&s<=o&&d.SelectCell(l,s,!0):"left"==r?t<=l&&l<=n&&o<=s&&s<=i&&d.SelectCell(l,s,!0):"topRight"==r?l<=n&&t<=l&&i<=s&&s<=o&&d.SelectCell(l,s,!0):"bottomLeft"==r&&n<=l&&l<=t&&s<=i&&o<=s&&d.SelectCell(l,s,!0),s++}),l++})}))}},{key:"OpenSettingsPanel",value:function(e,t){this.CloseSettingsPanel(),this.cellSettingsPanel=new a(this,e,t)}},{key:"CloseSettingsPanel",value:function(){null!=this.cellSettingsPanel&&this.cellSettingsPanel.destroy()}},{key:"GetNodeFromDom",value:function(e){var t=e.getAttribute("cm-id");return this.rootNode.document.GetNodeById(t)}},{key:"ApplyStyleOnSelectedLines",value:function(t,o){this.selectedNodes.forEach(function(e){e.children.forEach(function(e){e.isBlockNode()&&e.ToggleStyle(t,o,!0)})})}},{key:"_applyToTextNodes",value:function(e,t,o){var n;e.isTextNode()&&e.ToggleStyle(t,o,!0),null!=e.children&&(n=this,e.children.forEach(function(e){n._applyToTextNodes(e,t,o)}))}},{key:"ApplyStyleOnSelectedCells",value:function(t,o){var n=this;this.selectedNodes.forEach(function(e){n._applyToTextNodes(e,t,o)})}},{key:"DeleteContentOfSelectedCells",value:function(e){var t=0<arguments.length&&void 0!==e&&e,n=this.rootNode.document,i=void 0;this.selectedNodes.forEach(function(e){var t,o=e.children[0];o.children.forEach(function(e){t=e.nodeStyle.Copy(),n.DeleteNode(e,!1,!0,t)}),i=e.GetFirstTextNode()}),t&&null!=i&&i.SetFocus()}},{key:"_fintTDContainer",value:function(e){return null!=e.parent?"td"==e.parent.tagName?e.parent:this._fintTDContainer(e.parent):void 0}},{key:"MoveToNextCell",value:function(){var e,t=this.rootNode.document.GetNodeAtCursor();!t.isTextNode()||null!=(e=this._fintTDContainer(t))&&(null!=e.next?e.next.GetFirstTextNode().SetFocus():null!=e.parent&&(null!=e.parent.next?e.parent.next.children[0].GetFirstTextNode().SetFocus():null!=this.rootNode.next&&this.rootNode.next.GetFirstTextNode().SetFocus()))}},{key:"SelectAll",value:function(){this.DeselectAll();var t=0,o=0,n=this;this.rootNode.children.forEach(function(e){"tbody"==e.tagName.toLowerCase()&&e.children.forEach(function(e){o=0,e.children.forEach(function(e){n.SelectCell(t,o,!0),o++}),t++})})}},{key:"AddSelectedCellsToClipboard",value:function(e){var t=0<arguments.length&&void 0!==e&&e,o=this.rootNode.document,n=p.BlockNode.CreateNew(o,"table");n.SetAttributes([{name:"class",value:"commaTable"}]),n.SetPluginType(this.rootNode.GetPluginType());var i=p.BlockNode.CreateNew(o,"tbody"),r=this,l=void 0,s=void 0;this.selectedNodes.forEach(function(e){var t=r.GetCoordinatesPerNode(e.id);s!=t.row&&(null!=l&&i.Append(l),s=t.row,l=p.BlockNode.CreateNew(o,"tr")),l.Append(e.Copy())}),null!=l&&i.Append(l),n.Append(i),t&&this.DeleteContentOfSelectedCells(),this.rootNode.document.ForceClipboardContent(n.domElement)}},{key:"PasteCells",value:function(e){var t,o,n,i,r,l=!1,s=this,d=(new DOMParser).parseFromString(e,"text/html").body.firstElementChild;return null==d||null!=(t=[].slice.call(d.getElementsByTagName("tr")))&&0<t.length&&(l=!0,o=this.selectedNodes[0],n=this.GetCoordinatesPerNode(o.id),i=this.GetTableDimensions(),r=n.row,t.forEach(function(e){var o=n.col;[].slice.call(e.getElementsByTagName("td")).forEach(function(e){var t;r<i.rows&&o<i.cols&&(null!=(t=s.GetNodePerCoordinates(r,o))&&t.GetFirstTextNode().ForceTextContent(e.textContent.toString())),o++}),r++})),l&&this.PushToHistory(),l}},{key:"Fire",value:function(e,t,o,n){var i=JSON.parse(JSON.stringify(e));e==p.PluginActions.NEW_CHAR_ADDED&&"Backspace"==n.key&&1<this.selectedNodes.length&&(i=p.PluginActions.DELETE);var r=!1;switch(i){case p.PluginActions.LOST_FOCUS:this.CloseSettingsPanel(),this.DeselectAll();break;case p.PluginActions.BEFORE_PASTE:var l=n.clipboardData.getData("text/html");null!=l&&""!=l||(l=n.clipboardData.getData("text")),r=this.PasteCells(l);break;case p.PluginActions.BEFORE_COPY:var s,d=!0;1==this.selectedNodes.length&&(this.rootNode.document.selectionManager.IsCollapsed()?d=!0:(s=this.selectedNodes[0].domElement.textContent,null!=window.getSelection()&&(d=window.getSelection().toString()==s))),d&&(this.AddSelectedCellsToClipboard(),r=!0);break;case p.PluginActions.BEFORE_CUT:var a,c=!0;1==this.selectedNodes.length&&(this.rootNode.document.selectionManager.IsCollapsed()?c=!0:(a=this.selectedNodes[0].domElement.textContent,null!=window.getSelection()&&(c=window.getSelection().toString()==a))),c&&(this.AddSelectedCellsToClipboard(!0),r=!0);break;case p.PluginActions.SELECT_ALL:1==this.selectedNodes.length&&this.selectedNodes[0].SelectWholeTextContent(),r=!0;break;case p.PluginActions.APPLY_STYLE_ON_LINE:null==t&&this.ApplyStyleOnSelectedLines(n.styleName,n.value);break;case p.PluginActions.APPLY_STYLE_ON_TEXT:null==t&&this.ApplyStyleOnSelectedCells(n.styleName,n.value);break;case p.PluginActions.DELETE:this.DeleteContentOfSelectedCells(!0),r=!0;break;case p.PluginActions.CANCEL_FROM_TOP:r=!0;break;case p.PluginActions.DELETE_FROM_BOTTOM:this.rootNode.document.DeleteNode(this.rootNode),o.DeletePluginInstance(this),r=!1;break;case p.PluginActions.TAB:this.MoveToNextCell(),r=!0;break;default:return this.CloseSettingsPanel(),r}return r}}],[{key:"AddRow",value:function(e,t,o){null==o&&(o=new p.NodeStyle);for(var n=p.BlockNode.CreateNew(e,"tr"),i=0,r=void 0;i<t;){var l=f.AddCell(e,o);null==r&&(r=l.nodeForFocus),n.Append(l.td),i++}return{tr:n,nodeForFocus:r}}},{key:"AddCell",value:function(e,t){var o=p.BlockNode.CreateNew(e,"td");o.SetAttributes([{name:"class",value:"commaTableCell"}]);var n=p.BlockNode.CreateNew(e,"div"),i=p.TextNode.CreateNew(e,"span","",t.Copy());return n.Append(i),o.Append(n),{td:o,nodeForFocus:i}}},{key:"CreateNew",value:function(e,t){var o=e.GetStyleAtCurrentCursorPosition(),n=new p.NodeStyle(e,o.nodeStyle),i=e.GetNodeAtCursor().GetBlockContainer().InsertEmptyBlockNodeAfter("table");i.SetAttributes([{name:"class",value:"commaTable"}]);for(var r=p.BlockNode.CreateNew(e,"tbody"),l=t.rows,s=void 0,d=0;d<l;){var a=f.AddRow(e,t.cols,n);null==s&&(s=a.nodeForFocus),r.Append(a.tr),d++}i.Append(r);var c=i.InsertEmptyBlockNodeAfter("div"),u=p.TextNode.CreateNew(e,"span","",n.Copy());c.Append(u);var h=new f(i);return setTimeout(function(){s.SetFocus(),h.SelectCell(0,0)},100),h}},{key:"GetTagToParseOnPaste",value:function(){return["table"]}},{key:"CreateNewFromPastedNode",value:function(i,e){var t=p.BlockNode.CreateNew(i,"table");t.SetAttributes([{name:"class",value:"commaTable"}]);var o,r=p.BlockNode.CreateNew(i,"tbody");return null==e||null!=(o=[].slice.call(e.getElementsByTagName("tr")))&&o.forEach(function(e){var t=[].slice.call(e.getElementsByTagName("td"));0==t.length&&(t=[].slice.call(e.getElementsByTagName("th")));var o=f.AddRow(i,t.length,i.GetDefaultNodeStyle().Copy()).tr,n=0;t.forEach(function(e){o.children[n].GetFirstTextNode().ForceTextContent(e.textContent.toString()),n++}),r.Append(o)}),t.Append(r),new f(t)}}]),f}()}],i.c=r,i.d=function(e,t,o){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(o,n,function(e){return t[e]}.bind(null,n));return o},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/",i(i.s=1);function i(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,i),t.l=!0,t.exports}var n,r});